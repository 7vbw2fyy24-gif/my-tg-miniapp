<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ API</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: monospace; padding: 10px; }
        button { font-size: 16px; padding: 10px; margin-bottom: 15px; }
        pre { background-color: #f0f0f0; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <h1>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –û—Ç–ª–∞–¥–∫–∏</h1>
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API.</p>
    <button id="test-button">–í—ã–ø–æ–ª–Ω–∏—Ç—å –¢–µ—Å—Ç</button>

    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
    <pre id="result-output">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É...</pre>

    <script>
        // üî• –í–ê–ñ–ù–û: –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à –ê–ö–¢–£–ê–õ–¨–ù–´–ô URL –æ—Ç ngrok
        const API_BASE_URL = "https://unvigilantly-unmicrobial-bianca.ngrok-free.dev";

        const tg = window.Telegram.WebApp;
        
        const testButton = document.getElementById('test-button');
        const resultOutput = document.getElementById('result-output');

        async function performTest() {
            resultOutput.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è URL
                const url = new URL('/api/get_my_requests', API_BASE_URL).href;
                resultOutput.textContent += `\nURL: ${url}`;
                
                const response = await fetch(url, {
                    method: 'GET', // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥
                    headers: {
                        'Authorization': `tma ${tg.initData}`
                        'ngrok-skip-browser-warning': 'true'
                    }
                });

                resultOutput.textContent += `\n\n–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`;
                
                const responseText = await response.text();
                resultOutput.textContent += `\n\n–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:\n${responseText}`;

            } catch (error) {
                resultOutput.textContent = '!!! –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê FETCH !!!\n\n' + error.toString();
            }
        }

        testButton.onclick = performTest;
        
        tg.ready();
    </script>
</body>
</html>


